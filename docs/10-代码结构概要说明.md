# NewsMind æ™ºèƒ½æ–°é—»èšåˆç³»ç»Ÿ - ä»£ç ç»“æ„æ¦‚è¦è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

NewsMind æ˜¯ä¸€ä¸ªåŸºäº Python FastAPI + Vue.js çš„æ™ºèƒ½æ–°é—»èšåˆç³»ç»Ÿï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå¤šæºæ–°é—»é‡‡é›†ã€AIæ™ºèƒ½å¤„ç†å’Œå¤šè¯­è¨€å±•ç¤ºã€‚

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
NewsMind/
â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡ (FastAPI)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/            # APIè·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ tests/              # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ main.py             # åº”ç”¨å…¥å£
â”œâ”€â”€ frontend/               # å‰ç«¯åº”ç”¨ (Vue 3)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/     # Vueç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ views/          # é¡µé¢è§†å›¾
â”‚   â”‚   â”œâ”€â”€ stores/         # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ router/         # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ scripts/                # è¿ç»´è„šæœ¬
â”œâ”€â”€ docs/                   # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ docker-compose.yml      # å®¹å™¨ç¼–æ’
```

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯æ ˆ
- **Webæ¡†æ¶**: FastAPI (Python 3.9+)
- **æ•°æ®åº“**: SQLite (å¼€å‘) / PostgreSQL (ç”Ÿäº§)
- **ORM**: SQLAlchemy
- **AIå¤„ç†**: LangChain + DeepSeek API / LM Studio
- **ä»»åŠ¡è°ƒåº¦**: APScheduler
- **çˆ¬è™«**: Playwright + BeautifulSoup4
- **ç¼“å­˜**: å†…å­˜ç¼“å­˜
- **æ—¥å¿—**: Python logging

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Vue 3 + Composition API
- **æ„å»ºå·¥å…·**: Vite
- **UIç»„ä»¶**: Element Plus
- **çŠ¶æ€ç®¡ç†**: Pinia
- **HTTPå®¢æˆ·ç«¯**: Axios
- **è·¯ç”±**: Vue Router 4
- **æ ·å¼**: CSS3 + å“åº”å¼è®¾è®¡

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. åç«¯æ¨¡å— (backend/)

#### 1.1 APIå±‚ (app/api/)
```
api/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ ai.py          # AIå¤„ç†ç›¸å…³API
â””â”€â”€ news.py        # æ–°é—»ç®¡ç†ç›¸å…³API
```

**ä¸»è¦åŠŸèƒ½**:
- `ai.py`: AIå¤„ç†æ¥å£ï¼ŒåŒ…æ‹¬æ‰¹é‡å¤„ç†ã€å•ç¯‡å¤„ç†ã€ç»Ÿè®¡ä¿¡æ¯
- `news.py`: æ–°é—»CRUDæ¥å£ï¼ŒåŒ…æ‹¬åˆ—è¡¨æŸ¥è¯¢ã€è¯¦æƒ…è·å–ã€åˆ†ç±»ç­›é€‰

#### 1.2 æ ¸å¿ƒé…ç½® (app/core/)
```
core/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ cache.py       # ç¼“å­˜ç®¡ç†
â”œâ”€â”€ config.py      # åº”ç”¨é…ç½®
â”œâ”€â”€ database.py    # æ•°æ®åº“è¿æ¥
â””â”€â”€ logging.py     # æ—¥å¿—é…ç½®
```

**ä¸»è¦åŠŸèƒ½**:
- `config.py`: ç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œæ”¯æŒç¯å¢ƒå˜é‡å’Œ.envæ–‡ä»¶
- `database.py`: æ•°æ®åº“è¿æ¥æ± å’Œä¼šè¯ç®¡ç†
- `cache.py`: å†…å­˜ç¼“å­˜å®ç°
- `logging.py`: ç»“æ„åŒ–æ—¥å¿—é…ç½®

#### 1.3 æ•°æ®æ¨¡å‹ (app/models/)
```
models/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ news.py        # æ–°é—»ç›¸å…³æ¨¡å‹
â””â”€â”€ user.py        # ç”¨æˆ·ç›¸å…³æ¨¡å‹
```

**æ ¸å¿ƒæ¨¡å‹**:
- `NewsArticle`: æ–°é—»æ–‡ç« å®ä½“
- `ProcessedContent`: AIå¤„ç†ç»“æœ
- `NewsSource`: æ–°é—»æºé…ç½®
- `UserPreference`: ç”¨æˆ·åå¥½è®¾ç½®

#### 1.4 ä¸šåŠ¡æœåŠ¡å±‚ (app/services/)
```
services/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ ai_processor.py        # AIå†…å®¹å¤„ç†å™¨
â”œâ”€â”€ fast_ai_processor.py   # å¿«é€ŸAIå¤„ç†å™¨
â”œâ”€â”€ crawler.py             # æ–°é—»çˆ¬è™«æœåŠ¡
â”œâ”€â”€ news_service.py        # æ–°é—»ä¸šåŠ¡æœåŠ¡
â””â”€â”€ scheduler.py           # ä»»åŠ¡è°ƒåº¦æœåŠ¡
```

**æ ¸å¿ƒæœåŠ¡**:
- `ai_processor.py`: **å¤šåç«¯AIå¤„ç†å™¨**ï¼Œæ”¯æŒLM Studioå’ŒDeepSeekè‡ªåŠ¨åˆ‡æ¢
- `crawler.py`: å¤šæºæ–°é—»é‡‡é›†ï¼Œæ”¯æŒRSSå’Œç½‘é¡µæŠ“å–
- `news_service.py`: æ–°é—»æ•°æ®è®¿é—®å±‚ï¼Œå°è£…æ•°æ®åº“æ“ä½œ
- `scheduler.py`: å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼Œè‡ªåŠ¨é‡‡é›†å’Œå¤„ç†

### 2. å‰ç«¯æ¨¡å— (frontend/)

#### 2.1 ç»„ä»¶å±‚ (src/components/)
```
components/
â””â”€â”€ NewsCard.vue           # æ–°é—»å¡ç‰‡ç»„ä»¶
```

**ç»„ä»¶ç‰¹æ€§**:
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- åŒè¯­æ ‡é¢˜æ˜¾ç¤ºï¼ˆä¸­æ–‡ä¼˜å…ˆï¼‰
- æ™ºèƒ½æ‘˜è¦å±•ç¤º
- åˆ†ç±»æ ‡ç­¾å’Œå‘å¸ƒæ—¶é—´

#### 2.2 é¡µé¢è§†å›¾ (src/views/)
```
views/
â”œâ”€â”€ Home.vue              # é¦–é¡µæ–°é—»åˆ—è¡¨
â””â”€â”€ ArticleDetail.vue     # æ–‡ç« è¯¦æƒ…é¡µ
```

**é¡µé¢åŠŸèƒ½**:
- `Home.vue`: æ–°é—»åˆ—è¡¨å±•ç¤ºï¼Œæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æœç´¢
- `ArticleDetail.vue`: æ–‡ç« è¯¦æƒ…ï¼Œæ”¯æŒåŒè¯­å¯¹ç…§ã€AIæ‘˜è¦

#### 2.3 çŠ¶æ€ç®¡ç† (src/stores/)
```
stores/
â””â”€â”€ news.js              # æ–°é—»çŠ¶æ€ç®¡ç†
```

**çŠ¶æ€ç®¡ç†**:
- æ–°é—»åˆ—è¡¨æ•°æ®ç¼“å­˜
- åˆ†é¡µçŠ¶æ€ç®¡ç†
- ç­›é€‰æ¡ä»¶çŠ¶æ€
- åŠ è½½çŠ¶æ€æ§åˆ¶

---

## ğŸ¤– AIå¤„ç†æ¶æ„

### å¤šåç«¯æ”¯æŒè®¾è®¡

```python
# åè®®å®šä¹‰
class LLMBackend(Protocol):
    async def ainvoke(self, messages: list) -> Any:
        ...

# æœ¬åœ°LM Studioå®ç°
class LMStudioLLM:
    def __init__(self, api_url: str = "http://127.0.0.1:1234/v1/chat/completions"):
        self.api_url = api_url
    
    async def ainvoke(self, messages: list) -> Any:
        # OpenAIå…¼å®¹æ ¼å¼è°ƒç”¨æœ¬åœ°æœåŠ¡
        ...

# DeepSeekäº‘ç«¯å®ç°
class DeepSeekLLM:
    def __init__(self, api_key: str, model: str = "deepseek-chat"):
        self.llm = ChatDeepSeek(api_key=api_key, model=model)
    
    async def ainvoke(self, messages: list) -> Any:
        return await self.llm.ainvoke(messages)

# AIå¤„ç†å™¨è‡ªåŠ¨åˆ‡æ¢
class AIProcessor:
    def __init__(self, repo: NewsRepository, llm: LLMBackend = None):
        # ä¼˜å…ˆæœ¬åœ°LM Studioï¼Œä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢DeepSeek
        if llm is not None:
            self.llm = llm
        else:
            try:
                self.llm = LMStudioLLM()
                # æµ‹è¯•æœ¬åœ°æœåŠ¡å¯ç”¨æ€§
                await self.llm.ainvoke(test_messages)
            except Exception as e:
                logger.warning(f"æœ¬åœ°LM Studioä¸å¯ç”¨ï¼Œåˆ‡æ¢åˆ°DeepSeek: {e}")
                self.llm = DeepSeekLLM(api_key=settings.deepseek_api_key)
```

### AIå¤„ç†åŠŸèƒ½
- **æ™ºèƒ½æ‘˜è¦**: ä¸­è‹±æ–‡æ‘˜è¦ç”Ÿæˆ
- **å†…å®¹ç¿»è¯‘**: è‹±æ–‡æ–°é—»ä¸­æ–‡ç¿»è¯‘
- **è´¨é‡è¯„ä¼°**: æ–°é—»å†…å®¹è´¨é‡è¯„åˆ†
- **ä¸»é¢˜åˆ†ç±»**: è‡ªåŠ¨åˆ†ç±»æ ‡ç­¾

---

## ğŸ”„ æ•°æ®æµç¨‹

### 1. æ–°é—»é‡‡é›†æµç¨‹
```
å®šæ—¶ä»»åŠ¡ â†’ è·å–æ–°é—»æº â†’ å¹¶è¡ŒæŠ“å– â†’ å†…å®¹è§£æ â†’ è´¨é‡è¿‡æ»¤ â†’ å»é‡æ£€æŸ¥ â†’ å­˜å‚¨æ•°æ®åº“
```

### 2. AIå¤„ç†æµç¨‹
```
æ–°æ–‡ç« æ£€æµ‹ â†’ è¯­è¨€è¯†åˆ« â†’ å†…å®¹æ¸…æ´— â†’ æ‘˜è¦ç”Ÿæˆ â†’ ç¿»è¯‘å¤„ç† â†’ è´¨é‡è¯„ä¼° â†’ å­˜å‚¨ç»“æœ
```

### 3. å‰ç«¯å±•ç¤ºæµç¨‹
```
ç”¨æˆ·è¯·æ±‚ â†’ APIè°ƒç”¨ â†’ æ•°æ®æŸ¥è¯¢ â†’ ç»“æœå¤„ç† â†’ å‰ç«¯æ¸²æŸ“ â†’ ç”¨æˆ·äº¤äº’
```

---

## ğŸ› ï¸ è¿ç»´è„šæœ¬ (scripts/)

### æ ¸å¿ƒè„šæœ¬åˆ†ç±»
- **æ•°æ®ç®¡ç†**: `init_db.py`, `clear_database.py`, `upgrade_database.py`
- **æ–°é—»é‡‡é›†**: `simple_news_crawler.py`, `improved_news_crawler.py`, `multilingual_crawler.py`
- **AIå¤„ç†**: `ai_processor.py`, `async_ai_processor.py`, `batch_fix_articles.py`
- **æµ‹è¯•éªŒè¯**: `functional_test.py`, `integration_test.py`, `performance_test.py`
- **éƒ¨ç½²è¿ç»´**: `deploy.sh`, `deploy_production.sh`, `setup_auto_update.py`

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„
```sql
-- æ–°é—»æ–‡ç« è¡¨
news_articles (
    id, title, content, source_url, source_name, 
    publish_time, language, category, created_at, updated_at
)

-- AIå¤„ç†ç»“æœè¡¨
processed_content (
    id, article_id, summary_zh, summary_en, 
    translation_zh, quality_score, processing_time, created_at
)

-- æ–°é—»æºè¡¨
news_sources (
    id, name, url, type, category, weight, is_active, created_at
)

-- ç”¨æˆ·åå¥½è¡¨
user_preferences (
    id, key, value, updated_at
)
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ
```bash
# åç«¯å¯åŠ¨
cd backend && python -m uvicorn app.main:app --reload

# å‰ç«¯å¯åŠ¨
cd frontend && npm run dev
```

### ç”Ÿäº§ç¯å¢ƒ
```yaml
# docker-compose.yml
version: '3.8'
services:
  backend:
    build: ./backend
    ports: ["8000:8000"]
    environment:
      - DATABASE_URL=postgresql://...
  
  frontend:
    build: ./frontend
    ports: ["3000:80"]
    depends_on: [backend]
```

---

## ğŸ”§ é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env æ–‡ä»¶
DEEPSEEK_API_KEY=your_api_key
DATABASE_URL=sqlite:///./newsmind.db
LOG_LEVEL=INFO
DEBUG=true
```

### åº”ç”¨é…ç½® (app/core/config.py)
- æ”¯æŒç¯å¢ƒå˜é‡å’Œ.envæ–‡ä»¶
- ç±»å‹å®‰å…¨çš„é…ç½®éªŒè¯
- å¼€å‘/ç”Ÿäº§ç¯å¢ƒé…ç½®åˆ†ç¦»

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### åç«¯ä¼˜åŒ–
- æ•°æ®åº“è¿æ¥æ± 
- å†…å­˜ç¼“å­˜æœºåˆ¶
- å¼‚æ­¥å¤„ç†æ¶æ„
- æ‰¹é‡æ“ä½œä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
- ç»„ä»¶æ‡’åŠ è½½
- æ•°æ®åˆ†é¡µåŠ è½½
- å›¾ç‰‡æ‡’åŠ è½½
- çŠ¶æ€ç¼“å­˜

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•è¦†ç›–
- **å•å…ƒæµ‹è¯•**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- **é›†æˆæµ‹è¯•**: APIæ¥å£æµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•**: å®Œæ•´ç”¨æˆ·æµç¨‹
- **æ€§èƒ½æµ‹è¯•**: è´Ÿè½½å’Œå‹åŠ›æµ‹è¯•

### æµ‹è¯•å·¥å…·
- `pytest`: å•å…ƒæµ‹è¯•æ¡†æ¶
- `httpx`: APIæµ‹è¯•å®¢æˆ·ç«¯
- `playwright`: ç«¯åˆ°ç«¯æµ‹è¯•
- è‡ªå®šä¹‰æµ‹è¯•è„šæœ¬

---

## ğŸ“š æ–‡æ¡£ä½“ç³»

### æ–‡æ¡£åˆ†ç±»
- **éœ€æ±‚æ–‡æ¡£**: åŠŸèƒ½éœ€æ±‚å’ŒæŠ€æœ¯è¦æ±‚
- **è®¾è®¡æ–‡æ¡£**: ç³»ç»Ÿæ¶æ„å’Œæ¨¡å—è®¾è®¡
- **å¼€å‘æ–‡æ¡£**: ä»£ç è§„èŒƒå’Œå¼€å‘æŒ‡å—
- **æµ‹è¯•æ–‡æ¡£**: æµ‹è¯•ç”¨ä¾‹å’Œæµ‹è¯•æŠ¥å‘Š
- **éƒ¨ç½²æ–‡æ¡£**: ç¯å¢ƒé…ç½®å’Œéƒ¨ç½²æŒ‡å—

---

## ğŸ”® æ‰©å±•æ€§è®¾è®¡

### æ¨¡å—åŒ–æ¶æ„
- æœåŠ¡å±‚è§£è€¦ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
- æ’ä»¶åŒ–è®¾è®¡ï¼Œæ”¯æŒæ–°åŠŸèƒ½æ¨¡å—
- é…ç½®é©±åŠ¨ï¼Œå‡å°‘ç¡¬ç¼–ç 

### AIåç«¯æ‰©å±•
- åè®®åŒ–è®¾è®¡ï¼Œæ”¯æŒæ–°AIæœåŠ¡
- è‡ªåŠ¨æ•…éšœè½¬ç§»æœºåˆ¶
- å¤šæ¨¡å‹è´Ÿè½½å‡è¡¡

### æ•°æ®æºæ‰©å±•
- æ ‡å‡†åŒ–çˆ¬è™«æ¥å£
- æ”¯æŒæ–°æ•°æ®æºç±»å‹
- åŠ¨æ€é…ç½®ç®¡ç†

---

*æœ¬æ–‡æ¡£åæ˜ äº† NewsMind ç³»ç»Ÿå½“å‰çš„ä»£ç ç»“æ„å’Œæ¶æ„è®¾è®¡ï¼Œä¸ºåç»­å¼€å‘å’Œç»´æŠ¤æä¾›å‚è€ƒã€‚* 